!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).MVVM=e()}(this,(function(){"use strict";const t=function(){this.subs=[]};t.prototype={constructor:t,addSub:function(t){this.subs.push(t)},removeSub:function(t){this.subs.forEach((e,i)=>{e===t&&this.subs.splice(i,1)})},notify:function(){this.subs.forEach(t=>{t.update()})}};const e=function(t){this.observer(t)};e.prototype={constructor:e,observer:function(t){t&&"object"==typeof t&&Object.keys(t).forEach(e=>{this.defineReactive(t,e,t[e]),this.observer(t[e])})},defineReactive:function(e,i,n){let s=this,o=new t;Object.defineProperty(e,i,{enumerable:!0,configurable:!0,get:()=>(t.target&&o.addSub(t.target),n),set(t){t!==n&&(s.observer(t),n=t,o.notify())}})}};const i=function(t,e,i){this.vm=t,this.exp=e,this.callback=i,this.value=this.get()};i.prototype={constructor:i,getVal:function(t,e){return(e=e.split(".")).reduce((t,e)=>t[e],t.$data)},get:function(){t.target=this;let e=this.getVal(this.vm,this.exp);return t.target=null,e},update:function(){let t=this.getVal(this.vm,this.exp);t!==this.value&&this.callback(t)}};const n=function(t,e){this.el=this.isElementNode(t)?t:document.querySelector(t),this.vm=e,this.el&&(this.fragment=this.node2fragment(this.el),this.compile(this.fragment),this.el.appendChild(this.fragment))};n.prototype={constructor:n,compile(t){const e=t.childNodes;Array.from(e).forEach(t=>{this.isElementNode(t)?(this.compileElement(t),t.childNodes&&this.compile(t)):this.isTextNode(t)&&this.compileText(t)})},compileElement:function(t){const e=t.attributes;Array.from(e).forEach(e=>{const i=e.name;if(this.isDirective(i)){const n=e.value;if(this.isEvent(i))s.event(t,this.vm,n);else{const e=i.split("-")[1];s[e](t,this.vm,n)}}})},compileText:function(t){let e=t.textContent;/\{\{(.*)\}\}/.test(e)&&s.text(t,this.vm,RegExp.$1.trim())},node2fragment:function(t){let e,i=document.createDocumentFragment();for(;e=t.firstChild;)i.appendChild(e);return i},isElementNode:function(t){return 1===t.nodeType},isTextNode:function(t){return 3===t.nodeType},isDirective:function(t){return t.includes("v-")},isEvent:function(t){return t.includes("on")}};const s={getVal:(t,e)=>(e=e.split(".")).reduce((t,e)=>t[e],t.$data),setVal:(t,e,i)=>(e=e.split(".")).reduce((t,n,s)=>s===e.length-1?t[n]=i:t[n],t.$data),text:function(t,e,i){this.bind(t,e,i,"text")},html:function(t,e,i){this.bind(t,e,i,"html")},class:function(t,e,i){this.bind(t,e,i,"class")},model:function(t,e,i){this.bind(t,e,i,"model"),t.addEventListener("input",t=>{const n=t.target.value;n!==this.getVal(e,i)&&this.setVal(e,i,n)})},bind:function(t,e,n,s){const o=this.updater[s+"Updater"];new i(e,n,(e,i)=>{o&&o(t,e,i)}),o&&o(t,this.getVal(e,n))},event:function(t,e,i,n){const s=n.split(":")[1],o=e.$methods&&e.$methods[i];s&&o&&t.addEventListener(s,o.bind(e))},updater:{textUpdater:(t,e)=>{t.textContent=void 0===e?"":e},htmlUpdater:(t,e)=>{t.innerHTML=void 0===e?"":e},classUpdater:(t,e,i)=>{const n=t.className.replace(i,"").replace(/\s$/,""),s=n&&String(e)?" ":"";t.className=n+s+e},modelUpdater:(t,e)=>{t.value=void 0===e?"":e}}},o=function(t){this.$el=t.el,this.$data=t.data,this.$methods=t.methods,this.$el&&(new e(this.$data),this.proxyData(this.$data),new n(this.$el,this))};return o.prototype.proxyData=function(t){Object.keys(t).forEach(e=>{Object.defineProperty(this,e,{get:()=>t[e],set(i){t[e]=i}})})},o}));
